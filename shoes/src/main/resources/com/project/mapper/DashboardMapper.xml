<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mapper.DashboardMapper">

	<select id="getStatistics" resultType="com.project.domain.DashboardDataDTO">
	select
		(select nvl(count(product_id),0) from products where on_sale = 1 and discontinued = 0) as onSaleProductsCount,
		(select nvl(count(product_id),0) from products where on_sale = 0 and discontinued = 0) as offSaleProductsCount,
		(select nvl(count(distinct order_id),0) from purchases where trunc(purchase_date) = trunc(sysdate-1)) as dayPurchaseCount,
		(select nvl(sum(pu.purchase_amount*pr.price),0) from purchases pu join products pr on pu.product_id = pr.product_id where trunc(pu.purchase_date) = trunc(sysdate-1)) as daySalesAmount,
		(select nvl(count(distinct member_id),0) from purchases where trunc(purchase_date) = trunc(sysdate-1)) as dayCustomerCount,
		(select nvl(count(*),0) from qnas where answer is null) as notAnsweredCount,
		(select nvl(count(member_id),0) from members) as totalMemberCount,
		(select nvl(count(client_ip_address),0) from visit_counter where trunc(visit_date) = trunc(sysdate)) as todayVisitCount,
		(select nvl(count(client_ip_address),0) from visit_counter where trunc(visit_date) = trunc(sysdate-1)) as dailyVisitCount,
		(select nvl(count(client_ip_address),0) from visit_counter) as totalVisitCount
	from dual
	</select>
	
	<select id="getWeeklySalesAmount" resultType="com.project.domain.DashboardDataDTO">
		select nvl(sum(pu.purchase_amount*pr.price),0) as salesAmount, 
			   trunc(pu.purchase_date) as salesDate
		from purchases pu join products pr on pu.product_id = pr.product_id 
		where trunc(pu.purchase_date) between trunc(sysdate-7) and trunc(sysdate-1)
		group by trunc(pu.purchase_date)
	</select>
	
</mapper>